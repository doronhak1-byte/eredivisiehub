<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eredivisie Stand 2025-26</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .subtitle { font-size: 1.1em; opacity: 0.9; }
        .last-updated { font-size: 0.82em; opacity: 0.8; margin-top: 6px; }

        .content { padding: 30px; }

        .status-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            gap: 16px;
            color: #555;
        }

        .spinner {
            width: 48px; height: 48px;
            border: 5px solid #e0e0e0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .error-icon { font-size: 3em; }
        .error-msg { font-size: 1.05em; color: #cc0000; text-align: center; max-width: 480px; }

        .retry-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .retry-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }

        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 40px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        table { width: 100%; border-collapse: collapse; background: white; }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; }
        tr:hover { background: #f5f5f5; }

        .position { font-weight: bold; color: #667eea; width: 50px; }

        .team-name {
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .team-crest { width: 24px; height: 24px; object-fit: contain; }

        .champions-league   { border-left: 4px solid #0066cc; }
        .europa-league      { border-left: 4px solid #ff9900; }
        .conference-league  { border-left: 4px solid #00cc66; }
        .relegation-playoff { border-left: 4px solid #ff6600; }
        .relegation         { border-left: 4px solid #cc0000; }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-color { width: 20px; height: 20px; border-radius: 3px; }

        .toggle-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }

        .toggle-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .toggle-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .toggle-btn.active { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .chart-container { height: 350px; }
            th, td { padding: 8px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>⚽ Eredivisie Stand</h1>
            <p class="subtitle">Seizoen 2025-26 • Actuele Puntenstand</p>
            <p class="last-updated" id="lastUpdated"></p>
        </header>

        <div class="content">
            <div class="status-box" id="loadingState">
                <div class="spinner"></div>
                <p>Gegevens laden…</p>
            </div>

            <div class="status-box" id="errorState" style="display:none;">
                <span class="error-icon">⚠️</span>
                <p class="error-msg" id="errorMsg"></p>
                <button class="retry-btn" onclick="loadStandings()">Opnieuw proberen</button>
            </div>

            <div id="dataContent" style="display:none;">
                <div class="toggle-buttons">
                    <button class="toggle-btn active" onclick="showChart('points', event)">Punten</button>
                    <button class="toggle-btn" onclick="showChart('goals', event)">Doelpunten</button>
                    <button class="toggle-btn" onclick="showChart('goalDiff', event)">Doelsaldo</button>
                </div>

                <div class="chart-container">
                    <canvas id="standChart"></canvas>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="position">#</th>
                                <th>Team</th>
                                <th>GS</th>
                                <th>W</th>
                                <th>G</th>
                                <th>V</th>
                                <th>DV</th>
                                <th>DT</th>
                                <th>DS</th>
                                <th>Pts</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background:#0066cc;"></div>
                        <span>Champions League</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#ff9900;"></div>
                        <span>Europa League Kwalificatie</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#00cc66;"></div>
                        <span>Conference League Playoffs</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#ff6600;"></div>
                        <span>Degradatie Playoff</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#cc0000;"></div>
                        <span>Degradatie</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let standings    = [];
        let currentChart = null;
        let currentType  = 'points';

        function getRowClass(pos) {
            if (pos <= 2)   return 'champions-league';
            if (pos <= 4)   return 'europa-league';
            if (pos <= 8)   return 'conference-league';
            if (pos === 16) return 'relegation-playoff';
            if (pos >= 17)  return 'relegation';
            return '';
        }

        async function loadStandings() {
            showLoading();
            try {
                // Laad het lokale standings.json bestand dat GitHub Actions dagelijks bijwerkt
                const resp = await fetch('standings.json');
                if (!resp.ok) throw new Error(`Kan standings.json niet laden (HTTP ${resp.status})`);

                const json = await resp.json();
                const table = json.standings.find(s => s.type === 'TOTAL')?.table;
                if (!table) throw new Error('Onverwacht formaat in standings.json');

                standings = table.map(entry => ({
                    pos:   entry.position,
                    team:  entry.team.shortName || entry.team.name,
                    crest: entry.team.crest || '',
                    gp:    entry.playedGames,
                    w:     entry.won,
                    d:     entry.draw,
                    l:     entry.lost,
                    gf:    entry.goalsFor,
                    ga:    entry.goalsAgainst,
                    gd:    entry.goalDifference,
                    pts:   entry.points,
                    class: getRowClass(entry.position)
                }));

                // Toon de datum van het JSON-bestand als bijwerkdatum
                const lastMod = resp.headers.get('Last-Modified');
                setLastUpdated(lastMod ? new Date(lastMod) : new Date());

                populateTable();
                createChart(currentType);
                showData();

            } catch (err) {
                showError(err.message);
            }
        }

        function showLoading() {
            document.getElementById('loadingState').style.display = 'flex';
            document.getElementById('errorState').style.display   = 'none';
            document.getElementById('dataContent').style.display  = 'none';
        }

        function showError(msg) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display   = 'flex';
            document.getElementById('errorMsg').textContent        = `Fout: ${msg}`;
            document.getElementById('dataContent').style.display  = 'none';
        }

        function showData() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display   = 'none';
            document.getElementById('dataContent').style.display  = 'block';
        }

        function setLastUpdated(date) {
            const fmt = date.toLocaleString('nl-NL', {
                day: 'numeric', month: 'long', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
            document.getElementById('lastUpdated').textContent = `Bijgewerkt: ${fmt}`;
        }

        function populateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            standings.forEach(team => {
                const row = document.createElement('tr');
                row.className = team.class;
                const gdStr = team.gd > 0 ? `+${team.gd}` : `${team.gd}`;
                const crestHtml = team.crest
                    ? `<img src="${team.crest}" alt="" class="team-crest" loading="lazy">`
                    : '';
                row.innerHTML = `
                    <td class="position">${team.pos}</td>
                    <td><span class="team-name">${crestHtml}${team.team}</span></td>
                    <td>${team.gp}</td>
                    <td>${team.w}</td>
                    <td>${team.d}</td>
                    <td>${team.l}</td>
                    <td>${team.gf}</td>
                    <td>${team.ga}</td>
                    <td>${gdStr}</td>
                    <td><strong>${team.pts}</strong></td>
                `;
                tbody.appendChild(row);
            });
        }

        function createChart(type = 'points') {
            currentType = type;
            const ctx = document.getElementById('standChart').getContext('2d');
            if (currentChart) currentChart.destroy();

            const teams = standings.map(s => s.team);
            let data, label, color;

            switch (type) {
                case 'goals':
                    data = standings.map(s => s.gf); label = 'Doelpunten Voor'; color = '#f5576c'; break;
                case 'goalDiff':
                    data = standings.map(s => s.gd); label = 'Doelsaldo'; color = '#764ba2'; break;
                default:
                    data = standings.map(s => s.pts); label = 'Punten'; color = '#667eea';
            }

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: teams,
                    datasets: [{ label, data, backgroundColor: color, borderColor: color, borderWidth: 1, borderRadius: 5 }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top', labels: { font: { size: 14, weight: 'bold' } } },
                        tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', padding: 12, titleFont: { size: 14 }, bodyFont: { size: 13 } }
                    },
                    scales: {
                        y: { beginAtZero: type !== 'goalDiff', grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { font: { size: 12 } } },
                        x: { grid: { display: false }, ticks: { font: { size: 11 }, maxRotation: 45, minRotation: 45 } }
                    }
                }
            });
        }

        function showChart(type, event) {
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            createChart(type);
        }

        loadStandings();
    </script>
</body>
</html>
